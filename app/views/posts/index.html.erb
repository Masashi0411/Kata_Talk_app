<%= render "shared/common_header" %>

<main class="bg-background min-h-screen pb-20 px-4 pt-4">
  <% if @tip.present? %>
    <section class="mb-4">
      <h1 class="text-heading-lg font-semibold text-textPrimary">みんなのひとこと</h1>
      <!-- 旧: @tip.content → 新: @tip.title -->
      <p class="text-body-md text-textSecondary mt-1"><%= h @tip.title %></p>
    </section>

    <section class="space-y-3">
      <% @posts.each do |post| %>
        <% highlighted = (@highlight_post_id.to_i == post.id) %>

        <!-- ハイライトは青枠。青地にしたい場合は article の class を下のコメントのとおり変更 -->
        <article class="bg-surface shadow-sm rounded-lg p-4 border <%= highlighted ? 'border-accentBlue' : 'border-neutralGray' %>">
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center gap-2">
              <%= lucide_icon("circle-user", class: "w-5 h-5 text-textSecondary") %>
              <span class="text-label-sm text-textSecondary">
                <%= h(post.display_nickname.presence || "名無しさん") %>
              </span>
            </div>
            <% if highlighted %>
              <span class="text-label-sm text-accentBlue">あなたの投稿</span>
            <% end %>
          </div>

          <!-- ユーザー入力は必ずエスケープ -->
          <p class="text-body-md text-textPrimary whitespace-pre-wrap"><%= h post.content %></p>

          <div class="flex items-center justify-between mt-3">
            <!-- JSTで表示（アプリ設定が未調整でも確実に日本時間で出す） -->
            <span class="text-label-sm text-textSecondary">
              <%= l(post.created_at.in_time_zone("Tokyo"), format: :short) %>
            </span>
            <div class="flex items-center gap-1 text-textSecondary">
              <%= lucide_icon("heart", class: "w-4 h-4") %>
              <span class="text-label-sm">0</span> <%# MVPではプレースホルダ %>
            </div>
          </div>
        </article>

      <% end %>

      <% if @posts.blank? %>
        <div class="text-body-md text-textSecondary">まだ投稿がありません。</div>
      <% end %>
    </section>

    <section class="grid grid-cols-1 gap-3 mt-6">
      <% if @next_tip %>
        <%= link_to "次のひとことへ", drills_path(tip_id: @next_tip.id),
              class: "w-full h-12 rounded-lg bg-primaryOrange text-white flex items-center justify-center" %>
      <% end %>

      <%= link_to "今日はここまで", root_path,
            class: "w-full h-12 rounded-lg bg-neutralGray text-textPrimary flex items-center justify-center" %>

      <%# TODO: 「今日のひとこと一覧へ」 専用ページができたら差し替え %>
      <%= link_to "今日のひとこと一覧へ", tips_path,
            class: "w-full h-12 rounded-lg bg-neutralGray text-textPrimary flex items-center justify-center" %>
    </section>
  <% else %>
    <p class="text-body-md text-textSecondary">表示できるTIPがありません。</p>
  <% end %>
</main>

<%= render "shared/common_footer" %>
